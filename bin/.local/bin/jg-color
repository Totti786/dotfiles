#!/usr/bin/env bash

WALLPAPERS_DIR="$HOME/Pictures/Wallpapers"
CACHE_DIR="$HOME/.cache/wal"
COLORS_FILE="$CACHE_DIR/colors.json"

# Read color scheme from JSON file
color_scheme=($(jq -r '.colors[]' "$COLORS_FILE"))
# Get the current wallpaper
CURRENT_WALL="$(basename $(jq -r '.wallpaper' "$COLORS_FILE"))"
# Define output arrays
menu=()
submenu=()

# Add wallpaper colors section
menu+=("^sep(Wallpaper Colors)")
menu+=("北  ReGenerate Colors,^checkout(regen)")
submenu+=("^tag(regen)")
submenu+=("^sep(Regenerate)")
submenu+=("Shuffle Colors,wpg -z $CURRENT_WALL && wpg -s $CURRENT_WALL")

# Add colors from the color scheme
for i in "${color_scheme[@]}"; do
    menu+=("<tt><small>$i</small> <span bgcolor='$i'>                      </span></tt>,^checkout(${i:1}$((++n)))")
    submenu+=("^tag(${i:1}$n)")
    submenu+=("^sep(<tt>Color <small>$i</small> <span bgcolor='$i'>    </span></tt>)")
    submenu+=("Set as Folder Color,papirus-folder.sh --color '${i}'")
done

# Add set random wallpaper section
menu+=("^sep(Set random wallpaper)")
userwallp="$(shopt -s globstar nullglob ; files=($WALLPAPERS_DIR/**/*.{jpg,JPG,jpeg,JPEG,png,PNG}) ; echo "${#files[@]}")"
menu+=("  Wallpapers (<small>${userwallp}</small>),wpgtk random")

# Define main function to output results
main() {
    printf '%s\n' "${menu[@]}"
    printf '%s\n' "${submenu[@]}"
}

# Write results to output file
main > "$HOME/.config/jgmenu/colors.csv"
