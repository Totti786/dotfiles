#!/bin/bash

[ -f ~/.profile ] && source ~/.profile

hidden=/tmp/syshide.lock
res="`xdpyinfo | awk '/dimensions/{print $2}' | cut -d 'x' -f1`"

main(){
if [[ $(pidof stalonetray) ]]; then
	if [[ ! -e $hidden ]]; then
		polybar-msg action "#systray.hook.1"
		xdo hide -n stalonetray
		touch "$hidden"
		killall -9 systray
	else
		polybar-msg action "#systray.hook.0"
		xdo show -n stalonetray
		xdo raise -n stalonetray
		rm "$hidden"
		sleep 5 && main
	fi
else
	if [[ $style == "minimal" ]]; then 
		if [[ $res -gt "1920" ]]; then
			new="$(( $res - 1920 + 94 ))"
			stalonetray --geometry 1x1-$new-34 --grow-gravity SW &
			main			
		else
			main
		fi
		stalonetray --geometry 1x1-94-34 --grow-gravity SW &
		main
	else
		if [[ $res -gt "1920" ]]; then
			new="$(( $res - 1920 + 4 ))"
			stalonetray --geometry 1x1-$new+27 &
			main			
		else
			stalonetray &
			main
		fi
	fi
fi
}
main 
